---
title: "remap_interactive_rbp_scatter"
author: "juphilip"
date: "3/22/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# libraries
rm(list = ls())
library(dplyr)
library(ggplot2)
library(stringr)
library(ggforce)
library(tidyr)
library(ggiraph)
library(kableExtra)
library(cowplot)
library(pheatmap)
library(tibble)
theme_set(theme_cowplot())

library(scales)



```

# Alternative first events
```{r event definitions, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
human_ASTC <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/astc_events/astc_events_human.txt",header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1, "AF"))

human_AS <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/as_events/as_events_human.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1, "AF"))

chimp_ASTC <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/astc_events/astc_events_chimp.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1,"AF"))

chimp_AS <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/as_events/as_events_chimp.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1,"AF"))

orang_ASTC <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/astc_events/astc_events_orang.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1,"AF"))

orang_AS <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/as_events/as_events_orang.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1, "AF"))
```

# load conserved vs not conserved lists
```{r load astc lists, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/march_21/astc_top_bottom_lists.RData")
```

```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_chimp_AF/hc_AF_ASTC_snp_lvl_prelim.RData")

collapsed_output_total_score_human_chimp_AF <- collapsed_output_total_score

load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_chimp_AF/hc_AF_ASTC_collapsed_new_mismatches.RData")
collapsed_new_mismatches_human_chimp_AF <- hc_AF_ASTC_collapsed_new_mismatches
```

```{r load SNV background, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_chimp_AF_AS/human_chimp_AF_AS_variant_calling_data_SNP_level.RData")

collapsed_output_total_score_human_chimp_AF_SNV_bg <- collapsed_output_total_score

collapsed_new_mismatches_human_chimp_AF_SNV_bg <- collapsed_new_mismatches
```

```{r load background, eval=FALSE, echo = FALSE, warning=FALSE, error=FALSE, message=FALSE}

load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/march_21/summarized_rbp_bg.RData")
```



```{r human chimp AF NA replace, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# events that are ASTC in human and AS in chimp
# NAs replaced with zero
data_a_hc_AF <- collapsed_output_total_score_human_chimp_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & chimp_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0),
         species = "human_chimp",
         event_type = "AF") 



data_a_hc_AF_filtered <- collapsed_output_total_score_human_chimp_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & chimp_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = human-chimp) %>% 
  filter(diff > 2 | diff < -2)

data_b_hc_AF <- collapsed_output_total_score_human_chimp_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0),
         species = "human_chimp",
         event_type = "AF")

data_b_hc_AF_filtered <- collapsed_output_total_score_human_chimp_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = human-chimp) %>% 
  filter(diff > 2 | diff < -2)


```

```{r human chimp AF ASTC NA replace, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# events that are ASTC in both
data_c_hc_AF<- collapsed_output_total_score_human_chimp_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "AF")

data_c_hc_AF_filtered <- collapsed_output_total_score_human_chimp_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0)) %>% 
  mutate(diff = human - chimp) %>% 
  filter(diff > 2 | diff < -2)



```

```{r human chimp ASTC cons spec}
# events that are ASTC in both species (human and chimp) and have conserved sedimentation profiles
data_cons_hc_AF<- collapsed_output_total_score_human_chimp_AF %>% 
  filter(event_id %in% astc_hc_AF_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "AF",
         cat = "conserved")

# events that are ASTC in both species (human and chimp) and have conserved sedimentation profiles & filtered for difference between human and chimp in score
data_cons_hc_AF_filtered <- collapsed_output_total_score_human_chimp_AF %>% 
  filter(event_id %in% astc_hc_AF_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "AF",
         cat = "conserved") %>% 
  mutate(diff = human - chimp) %>% 
  filter(diff > 2 | diff < -2)

# events that are ASTC in both species (human and chimp) and have species-specific sedimentation profiles
data_spec_hc_AF<- collapsed_output_total_score_human_chimp_AF %>% 
  filter(event_id %in% astc_hc_AF_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "AF",
         cat = "species-specific")

data_spec_hc_AF_filtered<- collapsed_output_total_score_human_chimp_AF %>% 
  filter(event_id %in% astc_hc_AF_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "AF",
         cat = "species-specific") %>% 
  mutate(diff = human-chimp) %>% 
  filter(diff > 2 | diff < -2)

```




# human orang AF

## load data
```{r load human orang AF, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_orang_AF/human_orang_AF_variant_calling_data_SNP_level.RData")

collapsed_output_total_score_human_orang_AF <- collapsed_output_total_score

collapsed_new_mismatches_human_orang_AF <- collapsed_new_mismatches
```

```{r load human orang AF SNV background, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_orang_AF_AS/human_orang_AF_AS_variant_calling_data_SNP_level.RData")

collapsed_output_total_score_human_orang_AF_SNV_bg <- collapsed_output_total_score

collapsed_new_mismatches_human_orang_AF_SNV_bg <- collapsed_new_mismatches
```

## sort data
```{r human orang AF NA replace, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

data_a_ho_AF <- collapsed_output_total_score_human_orang_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "AF")

data_a_ho_AF_filtered <- collapsed_output_total_score_human_orang_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)

data_b_ho_AF <- collapsed_output_total_score_human_orang_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(human = replace_na(human, 0),
         orang = replace_na(orang, 0),
         species = "human_orang",
         event_type = "AF")

data_b_ho_AF_filtered <- collapsed_output_total_score_human_orang_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(human = replace_na(human, 0),
         orang = replace_na(orang, 0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)


  


```

```{r human orang ASTC AF NA replace, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

data_c_ho_AF <- collapsed_output_total_score_human_orang_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "AF")

data_c_ho_AF_filtered <- collapsed_output_total_score_human_orang_AF %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)

```

```{r human orang ASTC cons vs spec, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_cons_ho_AF<- collapsed_output_total_score_human_orang_AF %>% 
  filter(event_id %in% astc_ho_AF_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "AF",
         cat = "conserved")

data_cons_ho_AF_filtered <- collapsed_output_total_score_human_orang_AF %>% 
  filter(event_id %in% astc_ho_AF_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "AF",
         cat = "conserved") %>% 
  mutate(diff = human - orang) %>% 
  filter(diff > 2 | diff < -2)

data_spec_ho_AF<- collapsed_output_total_score_human_orang_AF %>% 
  filter(event_id %in% astc_ho_AF_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "AF",
         cat = "species-specific")

data_spec_ho_AF_filtered<- collapsed_output_total_score_human_orang_AF %>% 
  filter(event_id %in% astc_ho_AF_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "AF",
         cat = "species-specific") %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)

heatmap_cons <- ggplot(data = data_cons_ho_AF) +
  geom_point_interactive(aes(x=human, y=orang, color=current_motif, 
                             shape=cat))+
  theme(legend.position = "none") +
  geom_abline(intercept = 0, slope = 1) +
  ylab("human ASTC ") +
  xlab("orang ASTC") +
  #ylim(c(0,15)) +
  #xlim(c(0,15)) + 
  ggtitle("AF events human and orang")

heatmap_spec <- ggplot(data = data_spec_ho_AF) +
  geom_point_interactive(aes(x=human, y=orang, color=current_motif, 
                             shape=cat))+
  theme(legend.position = "none") +
  geom_abline(intercept = 0, slope = 1) +
  ylab("human ASTC ") +
  xlab("orang ASTC") +
  #ylim(c(0,15)) +
  #xlim(c(0,15)) + 
  ggtitle("AF events human and orang")
```

```{r human orang AF SNV background, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_d_ho_AF <- collapsed_output_total_score_human_orang_AF_SNV_bg %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  dplyr::summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human, 0),
         species = "human_orang",
         event_type = "AF")

data_d_ho_AF_filtered <- collapsed_output_total_score_human_orang_AF_SNV_bg %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  dplyr::summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)

  
```


# skipped exon events

## load event definitions
```{r event definitions SE, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
human_ASTC <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/astc_events/astc_events_human.txt",header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1, "SE"))

human_AS <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/as_events/as_events_human.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1, "SE"))

chimp_ASTC <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/astc_events/astc_events_chimp.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1,"SE"))

chimp_AS <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/as_events/as_events_chimp.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1,"SE"))

orang_ASTC <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/astc_events/astc_events_orang.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1,"SE"))

orang_AS <- read.delim("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/as_events/as_events_orang.txt", header = FALSE, stringsAsFactors = FALSE) %>% 
  filter(str_detect(V1, "SE"))
```

## human/chimp

## load data
```{r,  echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_chimp_SE/human_chimp_SE_variant_calling_data_SNP_level.RData")

collapsed_output_total_score_human_chimp_SE <- collapsed_output_total_score

collapsed_new_mismatches_human_chimp_SE <- collapsed_new_mismatches

```

```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_chimp_SE_AS/human_chimp_SE_AS_variant_calling_data_SNP_level.RData")

collapsed_output_total_score_human_chimp_SE_SNV_bg <- collapsed_output_total_score

collapsed_new_mismatches_human_chimp_SE_SNV_bg <- collapsed_new_mismatches

```

## sort data

```{r human chimp SE NA replace,  echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_a_hc_SE <- collapsed_output_total_score_human_chimp_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & chimp_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0),
         species = "human_chimp",
         event_type = "SE")

data_a_hc_SE_filtered <- collapsed_output_total_score_human_chimp_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & chimp_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = human-chimp) %>% 
  filter(diff > 2 | diff < -2)
  


data_b_hc_SE <- collapsed_output_total_score_human_chimp_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0),
         species = "human_chimp",
         event_type = "SE")

data_b_hc_SE_filtered <- collapsed_output_total_score_human_chimp_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = human-chimp) %>% 
  filter(diff > 2 | diff < -2)
  
```

```{r human chimp ASTC SE NA replace, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

data_c_hc_SE <- collapsed_output_total_score_human_chimp_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "SE")

data_c_hc_SE_filtered <- collapsed_output_total_score_human_chimp_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & chimp_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0)) %>% 
  mutate(diff = human-chimp) %>% 
  filter(diff >2 | diff < -2)
```

```{r human chimp ASTC SE cons spec, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_cons_hc_SE<- collapsed_output_total_score_human_chimp_SE %>% 
  filter(event_id %in% astc_hc_SE_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "SE",
         cat = "conserved")

data_cons_hc_SE_filtered <- collapsed_output_total_score_human_chimp_SE %>% 
  filter(event_id %in% astc_hc_SE_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "SE",
         cat = "conserved") %>% 
  mutate(diff = human - chimp) %>% 
  filter(diff > 2 | diff < -2)

data_spec_hc_SE<- collapsed_output_total_score_human_chimp_SE %>% 
  filter(event_id %in% astc_hc_SE_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "SE",
         cat = "species-specific")

data_spec_hc_SE_filtered<- collapsed_output_total_score_human_chimp_SE %>% 
  filter(event_id %in% astc_hc_SE_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp,0),
         human = replace_na(human,0),
         species = "human_chimp",
         event_type = "SE",
         cat = "species-specific") %>% 
  mutate(diff = human-chimp) %>% 
  filter(diff > 2 | diff < -2)

```

```{r human chimp SE SNV background, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_d_hc_SE <- collapsed_output_total_score_human_chimp_SE_SNV_bg %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  dplyr::summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & chimp_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0),
         species = "human_chimp",
         event_type = "SE")


data_d_hc_SE_filtered <- collapsed_output_total_score_human_chimp_SE_SNV_bg %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         chimp_ET = case_when(event_id %in% chimp_ASTC$V1 ~ "ASTC",
                              event_id %in% chimp_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, chimp_ET) %>% 
  dplyr::summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & chimp_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(chimp = replace_na(chimp, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = chimp-human) %>% 
  filter(diff > 2 | diff < -2)


```


## human/orang

## load data
```{r,  echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_orang_SE/human_orang_SE_variant_calling_data_SNP_level.RData")

collapsed_output_total_score_human_orang_SE <- collapsed_output_total_score

collapsed_new_mismatches_human_orang_SE <- collapsed_new_mismatches

```

```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
load("~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/human_orang_SE_AS/human_orang_SE_AS_variant_calling_data_SNP_level.RData")

collapsed_output_total_score_human_orang_SE_SNV_bg <- collapsed_output_total_score

collapsed_new_mismatches_human_orang_SE_SNV_bg <- collapsed_new_mismatches

```

## sort data
```{r human orang SE NA replace , echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

data_a_ho_SE <- collapsed_output_total_score_human_orang_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, source, Gene.name, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "SE")

data_a_ho_SE_filtered <- collapsed_output_total_score_human_orang_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, source, Gene.name, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "ASTC" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human,0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)

data_b_ho_SE <- collapsed_output_total_score_human_orang_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither" ),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name,source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "SE")

data_b_ho_SE_filtered <- collapsed_output_total_score_human_orang_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither" ),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name,source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2 )

```

```{r human orang ASTC SE NA replace, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

data_c_ho_SE <- collapsed_output_total_score_human_orang_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human, 0),
         species = "human_orang",
         event_type = "SE")

data_c_ho_SE_filtered <- collapsed_output_total_score_human_orang_SE %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  summarize(total_score = sum(score))%>% 
  filter(human_ET == "ASTC" & orang_ET == "ASTC") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)


```

```{r human orang ASTC SE cons vs spec, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_cons_ho_SE<- collapsed_output_total_score_human_orang_SE %>% 
  filter(event_id %in% astc_ho_SE_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "SE",
         cat = "conserved")

data_cons_ho_SE_filtered <- collapsed_output_total_score_human_orang_SE %>% 
  filter(event_id %in% astc_ho_SE_bottom$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "SE",
         cat = "conserved") %>% 
  mutate(diff = human - orang) %>% 
  filter(diff > 2 | diff < -2)

data_spec_ho_SE<- collapsed_output_total_score_human_orang_SE %>% 
  filter(event_id %in% astc_ho_SE_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "SE",
         cat = "species-specific")

data_spec_ho_SE_filtered<- collapsed_output_total_score_human_orang_SE %>% 
  filter(event_id %in% astc_ho_SE_top$event_id) %>% 
  group_by(current_snp, current_motif, Gene.name, source) %>% 
  summarize(total_score = sum(score))%>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang,0),
         human = replace_na(human,0),
         species = "human_orang",
         event_type = "SE",
         cat = "species-specific") %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)

```

```{r human orang SE SNV background, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

data_d_ho_SE <- collapsed_output_total_score_human_orang_SE_SNV_bg %>% 
  filter(score > 0) %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  dplyr::summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human, 0),
         species = "human_orang",
         event_type = "SE")

data_d_ho_SE_filtered <- collapsed_output_total_score_human_orang_SE_SNV_bg %>% 
  filter(score > 0) %>% 
  mutate(human_ET = case_when(event_id %in% human_ASTC$V1 ~ "ASTC",
                              event_id %in% human_AS$V1 ~ "AS",
                              TRUE ~ "neither"),
         orang_ET = case_when(event_id %in% orang_ASTC$V1 ~ "ASTC",
                              event_id %in% orang_AS$V1 ~ "AS",
                              TRUE ~ "neither")) %>% 
  group_by(current_snp, current_motif, Gene.name, source, human_ET, orang_ET) %>% 
  dplyr::summarize(total_score = sum(score)) %>% 
  filter(human_ET == "AS" & orang_ET == "AS") %>% 
  spread(source, total_score) %>% 
  mutate(orang = replace_na(orang, 0),
         human = replace_na(human, 0)) %>% 
  mutate(diff = human-orang) %>% 
  filter(diff > 2 | diff < -2)


```


## add significance based on prop test
```{r add significance levels to final data a tables, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_a_hc_AF_sig <- data_a_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_a_ho_AF_sig <- data_a_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_a_hc_SE_sig <- data_a_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_a_ho_SE_sig <- data_a_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

```

```{r add significance levels to final data b tables, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_b_hc_AF_sig <- data_b_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_b_ho_AF_sig <- data_b_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_b_hc_SE_sig <- data_b_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_b_ho_SE_sig <- data_b_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "AS_ASTC_total")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

```

```{r add significance levels to final data c tables, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_c_hc_AF_sig <- data_c_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "ASTC_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_c_ho_AF_sig <- data_c_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "ASTC_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_c_hc_SE_sig <- data_c_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "ASTC_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_c_ho_SE_sig <- data_c_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "ASTC_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

```

```{r add significance levels to final data d tables, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# this just adds NAs because data d are as/as tables used as comparison
data_d_hc_AF_sig <- data_d_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "AS_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_d_ho_AF_sig <- data_d_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "AS_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_d_hc_SE_sig <- data_d_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "AS_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_d_ho_SE_sig <- data_d_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "AS_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

```

```{r add significance levels to final cons data tables, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_cons_hc_AF_sig <-  data_cons_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_cons_hc_SE_sig <- data_cons_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_cons_ho_AF_sig <- data_cons_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_cons_ho_SE_sig <- data_cons_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")
```

```{r add significance levels to final spec data tables, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_spec_hc_AF_sig <-  data_spec_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_spec_hc_SE_sig <- data_spec_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_spec_ho_AF_sig <- data_spec_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_spec_ho_SE_sig <- data_spec_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "ASTC_cons")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")
```

```{r add significance levels to final data a tables individual sig, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# add signifcance levels from comparison of h_ASTC_c_AS to AS_AS, not the AS_ASTC_total
data_a_hc_AF_ind_sig <- data_a_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "h_ASTC_c_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_a_ho_AF_ind_sig <- data_a_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "h_ASTC_c_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_a_hc_SE_ind_sig <- data_a_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "h_ASTC_c_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_a_ho_SE_ind_sig <- data_a_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "h_ASTC_c_AS")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

```

```{r add significance levels to final data b tables individual sig, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# add signifcance levels from comparison of h_AS_c_ASTC to AS_AS, not the AS_ASTC_total

data_b_hc_AF_ind_sig <- data_b_hc_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_AF, type == "h_AS_c_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_b_ho_AF_ind_sig <- data_b_ho_AF %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_AF, type == "h_AS_c_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

data_b_hc_SE_ind_sig <- data_b_hc_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_hc_SE, type == "h_AS_c_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

 data_b_ho_SE_ind_sig <- data_b_ho_SE %>% 
  group_by(current_motif) %>% 
  left_join((subset(rbp_table_long_ho_SE, type == "h_AS_c_ASTC")), by = c("current_motif" = "RBP")) %>% 
  select(-"Gene.name.y","type","count","total","chisq","frequency")

```

# all comparisons and event types into one plot
```{r combine all observations, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
data_a_combined <- rbind(data_a_hc_AF_sig, data_a_hc_SE_sig, data_a_ho_AF_sig, data_a_ho_SE_sig)

data_b_combined <- rbind(data_b_hc_AF_sig, data_b_hc_SE_sig, data_b_ho_AF_sig, data_b_ho_SE_sig)

data_c_combined <- rbind(data_c_hc_AF_sig, data_c_hc_SE_sig, data_c_ho_AF_sig, data_c_ho_SE_sig)

data_d_combined <- rbind(data_d_hc_AF_sig, data_d_hc_SE_sig, data_d_ho_AF_sig, data_d_ho_SE_sig)

data_cons_combined <- rbind(data_cons_hc_AF_sig, data_cons_hc_SE_sig, data_cons_ho_AF_sig, data_cons_ho_SE_sig)

data_spec_combined <- rbind(data_spec_hc_AF_sig, data_spec_hc_SE_sig, data_spec_ho_AF_sig, data_spec_ho_SE_sig)

data_a_ind_combined <- rbind(data_a_hc_AF_ind_sig, data_a_hc_SE_ind_sig, data_a_ho_AF_ind_sig, data_a_ho_SE_ind_sig)
  
data_b_ind_combined <- rbind(data_b_hc_AF_ind_sig, data_b_hc_SE_ind_sig, data_b_ho_AF_ind_sig, data_b_ho_SE_ind_sig)


```

```{r turn data into heatmap, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# with frequency in cell but only if it's significant
# collecting data columns
# essentially four heatmaps for human/chimp AF, human/chimp SE, human/orang AF, human/orang SE

col_0 <- table_0 %>% 
  select(Var1)
colnames(col_0)[1] <- "current_motif"

# AS ASTC total AF hc
colA <- data_a_combined[which(data_a_combined$event_type == "AF" & data_a_combined$species == "human_chimp"),c("current_motif","chisq","frequency","sig")] %>% 
  rbind(data_b_combined[which(data_b_combined$event_type == "AF" & data_b_combined$species == "human_chimp"),c("current_motif","chisq","frequency","sig")])%>%  
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hASTC/cAS
colB <- data_a_ind_combined[which(data_a_ind_combined$event_type == "AF" & data_a_ind_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hAS/cASTC
colC <- data_b_ind_combined[which(data_b_ind_combined$event_type == "AF" & data_b_ind_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC/ASTC hc AF
colD <- data_c_combined[which(data_c_combined$event_type == "AF" & data_c_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# conserved ASTC
colE <- data_cons_combined[which(data_cons_combined$event_type == "AF" & data_cons_combined$species == "human_chimp"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# species specific ASTC
colF <- data_spec_combined[which(data_spec_combined$event_type == "AF" & data_spec_combined$species == "human_chimp"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hc AF background
colG <- data_d_combined[which(data_d_combined$event_type == "AF" & data_d_combined$species == "human_chimp"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, frequency)

# AS/ASTC hc SE
colH <- data_a_combined[which(data_a_combined$event_type == "SE" & data_a_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")] %>% 
  rbind(data_b_combined[which(data_b_combined$event_type == "SE" & data_b_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")]) %>%  
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC/ASTC hc SE
colI <- data_c_combined[which(data_c_combined$event_type == "SE" & data_c_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hASTC/cAS SE
colJ <- data_a_ind_combined[which(data_a_ind_combined$event_type == "SE" & data_a_ind_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hAS/cASTC SE
colK <- data_b_ind_combined[which(data_b_ind_combined$event_type == "SE" & data_b_ind_combined$species == "human_chimp"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC conserved hc SE
colL <- data_cons_combined[which(data_cons_combined$event_type == "SE" & data_cons_combined$species == "human_chimp"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# species specific ASTC hc SE
colM <- data_spec_combined[which(data_spec_combined$event_type == "SE" & data_spec_combined$species == "human_chimp"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# AS/AS SE hc background
colN <- data_d_combined[which(data_d_combined$event_type == "SE" & data_d_combined$species == "human_chimp"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, frequency)

# AS/ASTC ho AF

colO <- data_a_combined[which(data_a_combined$event_type == "AF" & data_a_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  rbind(data_b_combined[which(data_b_combined$event_type == "AF" & data_b_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")]) %>%  
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)
  
# hASTC/oAS
colP <- data_a_ind_combined[which(data_a_ind_combined$event_type == "AF" & data_a_ind_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hAS/oASTC
colQ <- data_b_ind_combined[which(data_b_ind_combined$event_type == "AF" & data_b_ind_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC/ASTC ho AF
colR <- data_c_combined[which(data_c_combined$event_type == "AF" & data_c_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC conserved ho AF
colS <- data_cons_combined[which(data_cons_combined$event_type == "AF" & data_cons_combined$species == "human_orang"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# species specific ASTC ho AF
colT <- data_spec_combined[which(data_spec_combined$event_type == "AF" & data_spec_combined$species == "human_orang"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# backgorund ho AF
colU <- data_d_combined[which(data_d_combined$event_type == "AF" & data_d_combined$species == "human_orang"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, frequency)

# AS/ASTC ho SE
colV <- data_a_combined[which(data_a_combined$event_type == "SE" & data_a_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  rbind(data_b_combined[which(data_b_combined$event_type == "SE" & data_b_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")]) %>%  
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hASTC/oAS
colW <- data_a_ind_combined[which(data_a_ind_combined$event_type == "SE" & data_a_ind_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# hAS/oASTC
colX <- data_b_ind_combined[which(data_b_ind_combined$event_type == "SE" & data_b_ind_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC/ASTC ho SE
colY <- data_c_combined[which(data_c_combined$event_type == "SE" & data_c_combined$species == "human_orang"), c("current_motif","chisq", "frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC cons ho SE
colZ <- data_cons_combined[which(data_cons_combined$event_type == "SE" & data_cons_combined$species == "human_orang"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# ASTC spec ho SE
colAA <- data_spec_combined[which(data_spec_combined$event_type == "SE" & data_spec_combined$species == "human_orang"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, freq)

# background ho SE
colBB <- data_d_combined[which(data_d_combined$event_type == "SE" & data_d_combined$species == "human_orang"), c("current_motif","chisq","frequency","sig")] %>% 
  unique() %>% 
  mutate(freq = case_when(!is.na(sig) ~ frequency)) %>% 
  unique() %>% 
  select(current_motif, frequency)

```


```{r bind norm log2, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
# bind columns together and normalize
test_heatmap_data_hc_AF <- col_0 %>% 
  left_join(colA, by = "current_motif") %>% 
  left_join(colB, by = "current_motif") %>% 
  left_join(colC, by = "current_motif") %>% 
  left_join(colD, by = "current_motif") %>% 
  left_join(colE, by = "current_motif") %>% 
  left_join(colF, by = "current_motif") %>% 
  left_join(colG, by = "current_motif") %>% 
  mutate(freq.x = log2(freq.x/frequency),
         freq.y = log2(freq.y/frequency),
         freq.x.x = log2(freq.x.x/frequency),
         freq.y.y = log2(freq.y.y/frequency),
         freq.x.x.x = log2(freq.x.x.x/frequency),
         freq.y.y.y = log2(freq.y.y.y/frequency)) %>% 
  mutate(frequency = log2(frequency/frequency)) %>% 
  column_to_rownames("current_motif")


test_heatmap_data_hc_SE <- col_0 %>% 
  left_join(colH, by = "current_motif") %>% 
  left_join(colI, by = "current_motif") %>% 
  left_join(colJ, by = "current_motif") %>% 
  left_join(colK, by = "current_motif") %>% 
  left_join(colL, by = "current_motif") %>% 
  left_join(colM, by = "current_motif") %>% 
  left_join(colN, by = "current_motif") %>% 
  mutate(freq.x = log2(freq.x/frequency),
         freq.y = log2(freq.y/frequency),
         freq.x.x = log2(freq.x.x/frequency),
         freq.y.y = log2(freq.y.y/frequency),
         freq.x.x.x = log2(freq.x.x.x/frequency),
         freq.y.y.y = log2(freq.y.y.y/frequency)) %>% 
  mutate(frequency = log2(frequency/frequency)) %>% 
  column_to_rownames("current_motif")

test_heatmap_data_ho_AF <- col_0 %>% 
  left_join(colO, by = "current_motif") %>% 
  left_join(colP, by = "current_motif") %>% 
  left_join(colQ, by = "current_motif") %>% 
  left_join(colR, by = "current_motif") %>% 
  left_join(colS, by = "current_motif") %>% 
  left_join(colT, by = "current_motif") %>% 
  left_join(colU, by = "current_motif") %>% 
  mutate(freq.x = log2(freq.x/frequency),
         freq.y = log2(freq.y/frequency),
         freq.x.x = log2(freq.x.x/frequency),
         freq.y.y = log2(freq.y.y/frequency),
         freq.x.x.x = log2(freq.x.x.x/frequency),
         freq.y.y.y = log2(freq.y.y.y/frequency)) %>% 
  mutate(frequency = log2(frequency/frequency)) %>% 
  column_to_rownames("current_motif")

test_heatmap_data_ho_SE <- col_0 %>% 
  left_join(colV, by = "current_motif") %>% 
  left_join(colW, by = "current_motif") %>% 
  left_join(colX, by = "current_motif") %>% 
  left_join(colY, by = "current_motif") %>% 
  left_join(colZ, by = "current_motif") %>% 
  left_join(colAA, by = "current_motif") %>% 
  left_join(colBB, by = "current_motif") %>% 
  mutate(freq.x = log2(freq.x/frequency),
         freq.y = log2(freq.y/frequency),
         freq.x.x = log2(freq.x.x/frequency),
         freq.y.y = log2(freq.y.y/frequency),
         freq.x.x.x = log2(freq.x.x.x/frequency),
         freq.y.y.y = log2(freq.y.y.y/frequency)) %>% 
  mutate(frequency = log2(frequency/frequency)) %>% 
  column_to_rownames("current_motif")

```

```{r heatmap annotation, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
hex_codes1 <- hue_pal()(80)
hex_codes2 <- hue_pal()(102)

rnacmpt_ids_sorted <- rnacmpt_ids %>% 
  arrange(ID)

heatmap_labels <- rnacmpt_ids_sorted %>% 
  mutate(PWM_RBP = paste0(Gene.name,"_",ID)) %>% 
  select(PWM_RBP, ID) %>% 
  column_to_rownames('ID')

annotation_colors <- hex_codes2
names(annotation_colors) <- heatmap_labels$PWM_RBP
annot_cols <- list(PWM_RBP = annotation_colors)
```


```{r for manuscript plotting heatmap normalize log2 in separate panels clust row false three columns only, echo = FALSE, warning=FALSE, message=FALSE}

# human/chimp AF

#filter out NA
test_heatmap_data_hc_AF_filtered <- test_heatmap_data_hc_AF %>% 
  select(c("freq.x","freq.y.y","frequency")) %>% 
  filter(!(is.na(freq.x) & is.na(freq.y.y)))

# replace inf
inf_df <- sapply(test_heatmap_data_hc_AF_filtered, is.infinite)
test_heatmap_data_hc_AF_filtered[inf_df] <- 0

colnames(test_heatmap_data_hc_AF_filtered) <- paste0("sample",1:ncol(test_heatmap_data_hc_AF_filtered))

col_labels <- c("AS_ASTC_total","ASTC_ASTC","AS_AS (ctrl)")

row_labels <- rnacmpt_ids_sorted_alpha[rnacmpt_ids_sorted_alpha$ID %in% rownames(test_heatmap_data_hc_AF_filtered),"Gene.name"]

pheatmap(test_heatmap_data_hc_AF_filtered, cluster_rows = FALSE, cluster_cols = FALSE, annotation_row = heatmap_labels, annotation_col = annot_rows, annotation_colors = annot_cols, labels_col = col_labels, labels_row = row_labels,
         cellwidth = 10,
         cellheight = 10,
         fontsize = 8,
         filename = "~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/march_21/summary_heatmap_hc_AF_rowsort_3col.pdf"
         )


# human/chimp SE

#filter out NA
test_heatmap_data_hc_SE_filtered <- test_heatmap_data_hc_SE %>% 
  select(c("freq.x","freq.y.y","frequency")) %>% 
  filter(!(is.na(freq.x) & is.na(freq.y.y)))

# replace inf
inf_df <- sapply(test_heatmap_data_hc_SE_filtered, is.infinite)
test_heatmap_data_hc_SE_filtered[inf_df] <- 0

colnames(test_heatmap_data_hc_SE_filtered) <- paste0("sample",1:ncol(test_heatmap_data_hc_SE_filtered))

col_labels <- c("AS_ASTC_total","ASTC_ASTC","AS_AS (ctrl)")


row_labels <- rnacmpt_ids_sorted_alpha[rnacmpt_ids_sorted_alpha$ID %in% rownames(test_heatmap_data_hc_SE_filtered),"Gene.name"]
  
pheatmap(test_heatmap_data_hc_SE_filtered, cluster_rows = FALSE, cluster_cols = FALSE, annotation_row = heatmap_labels, annotation_col = annot_rows, annotation_colors = annot_cols, labels_col = col_labels, labels_row = row_labels, 
         cellwidth = 10,
         cellheight = 10,
         fontsize = 8,
         filename = "~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/march_21/summary_heatmap_hc_SE_rowsort_3col.pdf"
         )

# human/orang AF
#filter out NA
test_heatmap_data_ho_AF_filtered <- test_heatmap_data_ho_AF %>% 
  select(c("freq.x","freq.y.y","frequency")) %>% 
  filter(!(is.na(freq.x) & is.na(freq.y.y)))

# replace inf
inf_df <- sapply(test_heatmap_data_ho_AF_filtered, is.infinite)
test_heatmap_data_ho_AF_filtered[inf_df] <- 0

colnames(test_heatmap_data_ho_AF_filtered) <- paste0("sample",1:ncol(test_heatmap_data_ho_AF_filtered))

col_labels <- c("AS_ASTC_total","ASTC_ASTC","AS_AS (ctrl)")


row_labels <- rnacmpt_ids_sorted_alpha[rnacmpt_ids_sorted_alpha$ID %in% rownames(test_heatmap_data_ho_AF_filtered),"Gene.name"]

pheatmap(test_heatmap_data_ho_AF_filtered, cluster_rows = FALSE, cluster_cols = FALSE, annotation_row = heatmap_labels, annotation_col = annot_rows, annotation_colors = annot_cols, labels_col = col_labels, labels_row = row_labels,
         cellwidth = 10,
         cellheight = 10,
         fontsize = 8,
         filename = "~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/march_21/summary_heatmap_ho_AF_rowsort_3col.pdf")


# human/orang SE
#filter out NA
test_heatmap_data_ho_SE_filtered <- test_heatmap_data_ho_SE %>% 
  select(c("freq.x","freq.y.y","frequency")) %>% 
  filter(!(is.na(freq.x) & is.na(freq.y.y)))

# replace inf
inf_df <- sapply(test_heatmap_data_ho_SE_filtered, is.infinite)
test_heatmap_data_ho_SE_filtered[inf_df] <- 0


colnames(test_heatmap_data_ho_SE_filtered) <- paste0("sample",1:ncol(test_heatmap_data_ho_SE_filtered))

col_labels <- c("AS_ASTC_total","ASTC_ASTC","AS_AS (ctrl)")


row_labels <- rnacmpt_ids_sorted_alpha[rnacmpt_ids_sorted_alpha$ID %in% rownames(test_heatmap_data_ho_SE_filtered),"Gene.name"]
  
pheatmap(test_heatmap_data_ho_SE_filtered, cluster_rows = FALSE, cluster_cols = FALSE, annotation_row = heatmap_labels, annotation_col = annot_rows, annotation_colors = annot_cols, labels_col = col_labels, labels_row = row_labels, 
         cellwidth = 10,
         cellheight = 10,
         fontsize = 8,
         filename = "~/Documents/05_results/01_primates/andrew_pipeline/remap_01_2020/cis_elements/march_21/summary_heatmap_ho_SE_rowsort_3col.pdf")

```


```{r euler diagram of RBPs}
library(eulerr)
# human_chimp AF vs human_orang_AF
fit1 <- euler(c("human_chimp_AF" = length(rownames(test_heatmap_data_hc_AF_filtered)), 
                "human_orang_AF" = length(rownames(test_heatmap_data_ho_AF_filtered)), 
                "human_chimp_AF&human_orang_AF" = length(intersect(rownames(test_heatmap_data_ho_AF_filtered), rownames(test_heatmap_data_hc_AF_filtered)))))

pdf("~/Dropbox/JP/rbp/AF_RBP_overlap.pdf")
plot(fit1,
     quantities = TRUE)
dev.off()

# human_chimp SE vs human_orang SE

fit2 <- euler(c("human_chimp_SE" = length(rownames(test_heatmap_data_hc_SE_filtered)), 
                "human_orang_SE" = length(rownames(test_heatmap_data_ho_SE_filtered)), 
                "human_chimp_SE&human_orang_SE" = length(intersect(rownames(test_heatmap_data_ho_SE_filtered), rownames(test_heatmap_data_hc_SE_filtered)))))

pdf("~/Dropbox/JP/rbp/SE_RBP_overlap.pdf")
plot(fit2,
     quantities = TRUE)
dev.off()

# human chimp AF vs human chimp SE
fit3 <- euler(c("human_chimp_SE" = length(rownames(test_heatmap_data_hc_SE_filtered)), 
                "human_chimp_AF" = length(rownames(test_heatmap_data_hc_AF_filtered)), 
                "human_chimp_SE&human_chimp_AF" = length(intersect(rownames(test_heatmap_data_hc_SE_filtered), rownames(test_heatmap_data_hc_AF_filtered)))))

pdf("~/Dropbox/JP/rbp/human_chimp_overlap.pdf")
plot(fit3,
     quantities = TRUE)
dev.off()

# human orang AF vs human orang SE
fit4 <- euler(c("human_orang_SE" = length(rownames(test_heatmap_data_ho_SE_filtered)), 
                "human_orang_AF" = length(rownames(test_heatmap_data_ho_AF_filtered)), 
                "human_orang_SE&human_orang_AF" = length(intersect(rownames(test_heatmap_data_ho_SE_filtered), rownames(test_heatmap_data_ho_AF_filtered)))))

pdf("~/Dropbox/JP/rbp/human_orang_overlap.pdf")
plot(fit4,
     quantities = TRUE)
dev.off()
```

```{r euler diagrams for event ids}
fit1 <- euler(c("human_chimp_AF" = length(unique(collapsed_output_total_score_human_chimp_AF$event_id)), 
                "human_chimp_SE" = length(unique(collapsed_output_total_score_human_chimp_SE$event_id)), 
                "human_chimp_SE&human_chimp_AF" = length(intersect(unique(collapsed_output_total_score_human_chimp_AF$event_id),unique(collapsed_output_total_score_human_chimp_SE$event_id)))))


fit2 <- euler(c("human_chimp_AF" = length(unique(collapsed_output_total_score_human_chimp_AF$event_id)), 
                "human_orang_AF" = length(unique(collapsed_output_total_score_human_orang_AF$event_id)), 
                "human_chimp_AF&human_orang_AF" = length(intersect(unique(collapsed_output_total_score_human_chimp_AF$event_id),unique(collapsed_output_total_score_human_orang_AF$event_id)))))

pdf("~/Dropbox/JP/rbp/AF_event_overlap.pdf")
plot(fit2,
     quantities = TRUE)
dev.off()


fit3 <- euler(c("human_chimp_SE" = length(unique(collapsed_output_total_score_human_chimp_SE$event_id)), 
                "human_orang_SE" = length(unique(collapsed_output_total_score_human_orang_SE$event_id)), 
                "human_chimp_SE&human_orang_SE" = length(intersect(unique(collapsed_output_total_score_human_chimp_SE$event_id),unique(collapsed_output_total_score_human_orang_SE$event_id)))))

pdf("~/Dropbox/JP/rbp/SE_event_overlap.pdf")
plot(fit3,
     quantities = TRUE)
dev.off()


```

```{r euler diagram of RBPs based on 3col}
library(eulerr)
# human_chimp AF vs human_orang_AF
fit1 <- euler(c("human_chimp_AF" = length(rownames(test_heatmap_data_hc_AF_filtered)), 
                "human_orang_AF" = length(rownames(test_heatmap_data_ho_AF_filtered)), 
                "human_chimp_AF&human_orang_AF" = length(intersect(rownames(test_heatmap_data_ho_AF_filtered), rownames(test_heatmap_data_hc_AF_filtered)))))

pdf("~/Dropbox/JP/rbp/AF_RBP_overlap_3col.pdf")
plot(fit1,
     quantities = TRUE)
dev.off()

# human_chimp SE vs human_orang SE

fit2 <- euler(c("human_chimp_SE" = length(rownames(test_heatmap_data_hc_SE_filtered)), 
                "human_orang_SE" = length(rownames(test_heatmap_data_ho_SE_filtered)), 
                "human_chimp_SE&human_orang_SE" = length(intersect(rownames(test_heatmap_data_ho_SE_filtered), rownames(test_heatmap_data_hc_SE_filtered)))))

pdf("~/Dropbox/JP/rbp/SE_RBP_overlap_3col.pdf")
plot(fit2,
     quantities = TRUE)
dev.off()

# human chimp AF vs human chimp SE
fit3 <- euler(c("human_chimp_SE" = length(rownames(test_heatmap_data_hc_SE_filtered)), 
                "human_chimp_AF" = length(rownames(test_heatmap_data_hc_AF_filtered)), 
                "human_chimp_SE&human_chimp_AF" = length(intersect(rownames(test_heatmap_data_hc_SE_filtered), rownames(test_heatmap_data_hc_AF_filtered)))))

pdf("~/Dropbox/JP/rbp/human_chimp_overlap_3col.pdf")
plot(fit3,
     quantities = TRUE)
dev.off()

# human orang AF vs human orang SE
fit4 <- euler(c("human_orang_SE" = length(rownames(test_heatmap_data_ho_SE_filtered)), 
                "human_orang_AF" = length(rownames(test_heatmap_data_ho_AF_filtered)), 
                "human_orang_SE&human_orang_AF" = length(intersect(rownames(test_heatmap_data_ho_SE_filtered), rownames(test_heatmap_data_ho_AF_filtered)))))

pdf("~/Dropbox/JP/rbp/human_orang_overlap_3col.pdf")
plot(fit4,
     quantities = TRUE)
dev.off()
```

```{r euler diagrams for event ids newly filtered}
fit1 <- euler(c("human_chimp_AF" = length(unique(collapsed_output_total_score_human_chimp_AF$event_id)), 
                "human_chimp_SE" = length(unique(collapsed_output_total_score_human_chimp_SE$event_id)), 
                "human_chimp_SE&human_chimp_AF" = length(intersect(unique(collapsed_output_total_score_human_chimp_AF$event_id),unique(collapsed_output_total_score_human_chimp_SE$event_id)))))


fit2 <- euler(c("human_chimp_AF" = length(unique(collapsed_output_total_score_human_chimp_AF$event_id)), 
                "human_orang_AF" = length(unique(collapsed_output_total_score_human_orang_AF$event_id)), 
                "human_chimp_AF&human_orang_AF" = length(intersect(unique(collapsed_output_total_score_human_chimp_AF$event_id),unique(collapsed_output_total_score_human_orang_AF$event_id)))))

pdf("~/Dropbox/JP/rbp/AF_event_overlap_3col.pdf")
plot(fit2,
     quantities = TRUE)
dev.off()


fit3 <- euler(c("human_chimp_SE" = length(unique(collapsed_output_total_score_human_chimp_SE$event_id)), 
                "human_orang_SE" = length(unique(collapsed_output_total_score_human_orang_SE$event_id)), 
                "human_chimp_SE&human_orang_SE" = length(intersect(unique(collapsed_output_total_score_human_chimp_SE$event_id),unique(collapsed_output_total_score_human_orang_SE$event_id)))))

pdf("~/Dropbox/JP/rbp/SE_event_overlap_3col.pdf")
plot(fit3,
     quantities = TRUE)
dev.off()


```